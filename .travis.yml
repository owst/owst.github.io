language: ruby
sudo: false
git:
  depth: 1
cache: bundler
script:
  - bundle exec jekyll build --verbose
after_success:
  - git fetch origin master:refs/remotes/origin/master
  - git checkout origin/master
  - mv CNAME .git _site/
  - find . -mindepth 1 -maxdepth 1 -not -name _site -exec rm -r {} \;
  - mv _site/* _site/.git .
  - rmdir _site
  - git config --global user.email "travis@travis-ci.org"
  - git config --global user.name "Travis CI"
  - git add .
  - 'git commit --message "Travis build: $TRAVIS_BUILD_NUMBER"'
  - git status
  - git push https://${GH_TOKEN}@github.com/owst/owst.github.io
