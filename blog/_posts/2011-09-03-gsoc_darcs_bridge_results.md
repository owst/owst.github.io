---
title: 'GSoC: Darcs Bridge – Results'
published: false
---
So, that's it, GSoC is over! Sorry I've been slack on the updates, I should
have definitely kept on top of them better...

Anyway, it's been an interesting summer, frustrating at (most of the! :-))
times, confusing and hard work... sounds like fun? Well, it was! I've learnt a
great deal about Darcs, Haskell, VCSs and working alone (and that I need to
force myself to write blog updates in a more timely fashion!) and I've had an
ultimately very rewarding experience.

So, what have I actually achieved? (If you want to jump right into how to *use*
the bridge, check out the wiki page I've created here:
[http://wiki.darcs.net/DarcsBridgeUsage](http://wiki.darcs.net/DarcsBridgeUsage))
I suppose the easiest way to judge this is to take the list of pre-project
targets and see where we are with them:


1. **Allow automatic incremental conversion:**  Check!
This definitely works well.

1. **Create a mapping/encoding of multi-head repositories:**  Check!
   Using a special tagging-scheme as described on the wiki, we are able to
   import (and re-export) branches/merges, mapping individual Git branches onto
   separate Darcs repositories.
1. **Import and export foreign patch formats generated by VCS “send”
   commands:**  Check 1/2! 
   This works for applying Git patches to a Darcs repository, but the reverse
   operation turned out to be difficult to handle correctly. (We're not
   convinced that there are particularly compelling use-cases either.) If there
   was particular demand, I would hope that with a bit of further
   effort/thinking it would be possible to code up a solution.
1. **Solve the problem of efficiently translating to/from Darcs patches:**
   Check! 
   This goal is a bit of a strange one; given that we've decided to do complete
   translations of the repositories, rather than on-the-fly conversions, we've
   basically side-stepped any after-conversion performance problems, since the
   generated repositories are repositories-proper and do not have any
   translation-associated performance problems.
1. **“Roundtripping”, whereby information may be lost when converting to and
   back from another repository format. (Particularly), Translation to and from
   Darcs specific patch-types e.g. replace patches:**  Check (mostly)! 
   Exporting replace patches can be recovered, assuming the replace primitives
   are at the "start" or "end" of a patch, rather than in the middle
   (intermediate states cannot be recovered/transmitted, hence the restriction
   - see the wiki page for more). Currently (as described in the wiki page)
   Darcs conflicts that are resolved using >1 patch (assuming the
   tagging-scheme is used) will be coalesced into a single resolution patch,
   upon exporting. In practice I imagine this isn't really a problem, but that
   said I'm hopeful it'd not be particularly difficult to fix.
1. **The cycle problem, in the presence of multiple bridges.** 
   N/A Again, due to choosing one-off translations I don't think that multiple
   bridges will cause any issues.
1. **Create a consistent mapping between Darcs2 and Darcs1 format
   repositories.** Unchecked. I never got around to this feature; given that
   there exists a tool to do one-time conversions to Darcs-2 I'm not
   particularly concerned.

So, all-in-all, pretty good! There are a few things I'd like to get tidied up
though...

**TODOs:**

- Further investigation with Darcs/Haskell gurus (Ganesh and Petr, I'm looking
  at you!) as to how I can improve the performance and resource-usage of
  darcs-bridge. Currently, exporting Darcs repositories is too memory-hungry,
  something I definitely want to improve.
- Attempting to import the Git source Git repo manages to trip Darcs itself up;
  there is a corner case of the patch-theory implementation in current Darcs:
  [http://bugs.darcs.net/issue1520](http://bugs.darcs.net/issue1520)  that the
  changes/conflicts/resolutions in the Git repo manage to find. I suspect that
  others who are much more clever than myself have spent hours looking at the
  problem with no luck (since it's still not fixed)... I wonder if a fresh pair
  of eyes will spot anything or if the code's too opaque?
- Release! Once the performance has been tweaked a bit more, it'll be time to
  actually release darcs-bridge to the wider-world! Maintainership and
  bug-reporting and naming (currently the code/packaging is all centred around
  the darcs-fastconvert name, I think darcs-bridge should be separate to
  signify its improvements/differences) are some things I can think of that
  need discussion beforehand.


So, what next, Darcs-wise? I think I want to look into understanding and
hopefully continuing Petr's work on the [next-generation
primitive-patches](http://web.mornfall.net/blog/soc_reloaded:_outcomes.html),
particularly, how they fit into a repo-model (things like conflicts,duplicates
and the issues their design throws up).

And finally...

A big thank you to Google for running the summer-of-code programme, Haskell.org
for accepting my project (gaining a very keen Haskeller and Darcs-hacker in the
process :-)) and the #darcs inhabitants: kowey, gh, mornfall sm and iago to
name a few and particularly Ganesh for his advice throughout the project; all
three groups were invaluable and this project couldn't have gone ahead without
any one of them.
